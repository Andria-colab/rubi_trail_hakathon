import os
import secrets
import hmac
import hashlib
import json
from datetime import datetime
from io import BytesIO
from urllib.parse import parse_qsl

import qrcode
import requests
from flask import Flask, request, jsonify, render_template_string
from flask_sqlalchemy import SQLAlchemy
from flask_cors import CORS


# -----------------------
# FLASK SETUP
# -----------------------
app = Flask(__name__, static_folder="frontend", static_url_path="")
CORS(app, supports_credentials=True, resources={r"/*": {"origins": [
    "https://rubi-trail-hakathon.vercel.app",
    "https://rubi-trail-hakathon-git-main-<your>.vercel.app"
]}})

BASE_DIR = os.path.abspath(os.path.dirname(__file__))
DB_PATH = os.path.join(BASE_DIR, "instance", "rubi_trail.db")
os.makedirs(os.path.dirname(DB_PATH), exist_ok=True)

app.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///" + DB_PATH
app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False
app.config["SECRET_KEY"] = os.environ.get("SECRET_KEY", "change-me-in-production")

db = SQLAlchemy(app)

TELEGRAM_BOT_TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN", "").strip()


# -----------------------
# DATABASE MODELS
# -----------------------
class User(db.Model):
    __tablename__ = "users"
    id = db.Column(db.Integer, primary_key=True)
    telegram_id = db.Column(db.String(64), unique=True, nullable=False)
    name = db.Column(db.String(128))
    coins = db.Column(db.Integer, default=0)


class Attraction(db.Model):
    __tablename__ = "attractions"
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(255), nullable=False)
    description = db.Column(db.Text)
    address = db.Column(db.Text)
    lat = db.Column(db.Float)
    lon = db.Column(db.Float)
    reward_coins = db.Column(db.Integer, nullable=False, default=10)
    qr_code_value = db.Column(db.String(255), unique=True, nullable=False)


class Visit(db.Model):
    __tablename__ = "visits"
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=False)
    attraction_id = db.Column(db.Integer, db.ForeignKey("attractions.id"), nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

    __table_args__ = (
        db.UniqueConstraint("user_id", "attraction_id", name="uq_user_attraction"),
    )


class Service(db.Model):
    __tablename__ = "services"
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(128), nullable=False)
    logo_url = db.Column(db.String(256))
    description = db.Column(db.String(256))


class Reward(db.Model):
    __tablename__ = "rewards"
    id = db.Column(db.Integer, primary_key=True)
    service_id = db.Column(db.Integer, db.ForeignKey("services.id"), nullable=False)
    title = db.Column(db.String(128), nullable=False)
    description = db.Column(db.String(256))
    price_coins = db.Column(db.Integer, nullable=False)

    service = db.relationship("Service", backref="rewards")


class Voucher(db.Model):
    __tablename__ = "vouchers"
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=False)
    reward_id = db.Column(db.Integer, db.ForeignKey("rewards.id"), nullable=False)
    service_id = db.Column(db.Integer, db.ForeignKey("services.id"), nullable=False)

    redeem_token = db.Column(db.String(64), unique=True, nullable=False)
    status = db.Column(db.String(16), nullable=False, default="ACTIVE")
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    redeemed_at = db.Column(db.DateTime)

    user = db.relationship("User", backref="vouchers")
    reward = db.relationship("Reward", backref="vouchers")
    service = db.relationship("Service", backref="vouchers")


# -----------------------
# DB INIT + SEED
# -----------------------
def seed_if_empty():
    if Reward.query.first() is not None:
        return

    s1 = Service(name="Tavaduri", logo_url="data:image/jpeg;base64,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", description="Cozy restaurant.")
    s2 = Service(name="Art House Cafe", logo_url="data:image/jpeg;base64,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", description="Cafe.")
    s3 = Service(name="Museum of Arts", logo_url="data:image/jpeg;base64,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", description="Museum.")
    db.session.add_all([s1, s2, s3])
    db.session.flush()

    r1 = Reward(service_id=s1.id, title="Tavaduri 20% Cashback", description="Max 40 GEL", price_coins=20)
    r2 = Reward(service_id=s2.id, title="Art House 15% Cashback", description="Max 30 GEL", price_coins=15)
    r3 = Reward(service_id=s3.id, title="Free entrance", description="Free entry", price_coins=10)
    db.session.add_all([r1, r2, r3])

    a1 = Attraction(
        title="Ali and Nino",
        description="Batumi Boulevard attraction.",
        address="Batumi Boulevard",
        lat=41.6539,
        lon=41.6360,
        reward_coins=10,
        qr_code_value="AliAndNiNoVisit27",
    )
    a2 = Attraction(
        title="Alphabetic Tower",
        description="Batumi Boulevard attraction.",
        address="Batumi Boulevard",
        lat=41.656088567441216,
        lon=41.639600470801206,
        reward_coins=10,
        qr_code_value="AliAndNiNoVisit90",
    )
    a3 = Attraction(
        title="GITA TouristHack 2025",
        description="Tech Park Batumi attraction.",
        address="Tech Park Batumi",
        lat=41.62386745993197,
        lon=41.62490440795824,
        reward_coins=10,
        qr_code_value="AliAndNiNoVisit72",
    )
    db.session.add_all([a1, a2, a3])

    db.session.commit()
    print(" Seeded demo data")


with app.app_context():
    db.create_all()
    seed_if_empty()
    print(" DB ready")


# -----------------------
# TELEGRAM VERIFY
# -----------------------
def verify_telegram_init_data(init_data: str):
    """
    Verifies Telegram Mini App initData (WebAppData).
    Returns the parsed tg user dict if valid, else None.
    """
    if not TELEGRAM_BOT_TOKEN or not init_data:
        return None

    data = dict(parse_qsl(init_data, keep_blank_values=True))
    hash_received = data.pop("hash", None)
    if not hash_received:
        return None

    # Build data_check_string
    check_string = "\n".join(f"{k}={data[k]}" for k in sorted(data.keys()))

    #  Correct secret key for Mini Apps:
    # secret_key = HMAC_SHA256("WebAppData", bot_token)
    secret_key = hmac.new(b"WebAppData", TELEGRAM_BOT_TOKEN.encode(), hashlib.sha256).digest()

    # Calculate hash
    hash_calc = hmac.new(secret_key, check_string.encode(), hashlib.sha256).hexdigest()

    if not hmac.compare_digest(hash_calc, hash_received):
        return None

    user_json = data.get("user")
    if not user_json:
        return None

    return json.loads(user_json)


# -----------------------
# TELEGRAM SENDERS
# -----------------------
def send_telegram_message(chat_id: str, text: str) -> bool:
    if not TELEGRAM_BOT_TOKEN:
        return False
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    r = requests.post(url, json={"chat_id": chat_id, "text": text}, timeout=10)
    return r.ok


def send_telegram_qr(chat_id: str, caption: str, qr_payload: str) -> bool:
    if not TELEGRAM_BOT_TOKEN:
        return False

    img = qrcode.make(qr_payload)
    buf = BytesIO()
    img.save(buf, format="PNG")
    buf.seek(0)

    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendPhoto"
    r = requests.post(
        url,
        data={"chat_id": chat_id, "caption": caption},
        files={"photo": ("voucher.png", buf, "image/png")},
        timeout=15,
    )
    return r.ok


# -----------------------
# AUTH / SESSION
# -----------------------
def get_current_user():
    auth = request.headers.get("Authorization", "")
    if auth.startswith("Bearer "):
        token = auth.split(" ", 1)[1].strip()
        if token.isdigit():
            return User.query.get(int(token))
    return None


# -----------------------
# FRONTEND
# -----------------------
# -----------------------
# FRONTEND
# -----------------------
@app.get("/")
def serve_index():
    return app.send_static_file("index.html")


# -----------------------
# API
# -----------------------
@app.post("/auth/telegram")
def auth_telegram():
    body = request.get_json(silent=True) or {}
    init_data = (body.get("initData") or "").strip()

    print("INIT DATA RECEIVED LENGTH:", len(init_data))
    print("BOT TOKEN SET:", bool(TELEGRAM_BOT_TOKEN))

    tg_user = verify_telegram_init_data(init_data)
    if not tg_user:
        print(" TELEGRAM VERIFY FAILED")
        return jsonify({"error": "Not launched as Telegram Mini App (no valid initData)."}), 401

    telegram_id = str(tg_user["id"])
    name = (
        (tg_user.get("first_name", "") + " " + tg_user.get("last_name", "")).strip()
        or tg_user.get("username", "User")
    )

    user = User.query.filter_by(telegram_id=telegram_id).first()
    if not user:
        user = User(telegram_id=telegram_id, name=name, coins=0)
        db.session.add(user)
        db.session.commit()
    else:
        if name and name != (user.name or ""):
            user.name = name
            db.session.commit()

    return jsonify({
        "token": str(user.id),
        "user": {"id": user.id, "name": user.name, "coins": user.coins}
    }), 200


@app.get("/api/me")
def api_me():
    user = get_current_user()
    if not user:
        return jsonify({"error": "unauthorized"}), 401
    return jsonify({"id": user.id, "name": user.name, "coins": user.coins})


@app.post("/api/attractions/scan")
def scan_attraction():
    user = get_current_user()
    if not user:
        return jsonify({"success": False, "message": "Unauthorized"}), 401

    data = request.get_json(silent=True) or {}
    qr_value = (data.get("qrText") or data.get("code") or "").strip()
    if not qr_value:
        return jsonify({"success": False, "message": "No QR code provided"}), 400

    attraction = Attraction.query.filter_by(qr_code_value=qr_value).first()
    if not attraction:
        return jsonify({"success": False, "message": "Invalid QR code"}), 404

    existing = Visit.query.filter_by(user_id=user.id, attraction_id=attraction.id).first()
    if existing:
        return jsonify({"success": False, "message": "Already claimed.", "newBalance": user.coins, "addedCoins": 0})

    user.coins += attraction.reward_coins
    db.session.add(Visit(user_id=user.id, attraction_id=attraction.id))
    db.session.commit()

    return jsonify({"success": True, "message": "Scan accepted!", "newBalance": user.coins, "addedCoins": attraction.reward_coins})


@app.get("/api/rewards")
def list_rewards():
    user = get_current_user()
    if not user:
        return jsonify({"error": "Unauthorized"}), 401

    rewards = Reward.query.all()
    return jsonify({
        "userCoins": user.coins,
        "rewards": [
            {
                "id": r.id,
                "title": r.title,
                "description": r.description,
                "priceCoins": r.price_coins,
                "service": {
                    "id": r.service.id,
                    "name": r.service.name,
                    "logoUrl": r.service.logo_url,
                    "description": r.service.description,
                },
            }
            for r in rewards
        ],
    })


@app.post("/api/rewards/<int:reward_id>/buy")
def buy_reward(reward_id: int):
    user = get_current_user()
    if not user:
        return jsonify({"success": False, "message": "Unauthorized"}), 401

    reward = Reward.query.get(reward_id)
    if not reward:
        return jsonify({"success": False, "message": "Reward not found"}), 404

    if user.coins < reward.price_coins:
        return jsonify({"success": False, "message": "Not enough coins.", "newBalance": user.coins}), 400

    user.coins -= reward.price_coins

    token = secrets.token_urlsafe(16)
    voucher = Voucher(
        user_id=user.id,
        reward_id=reward.id,
        service_id=reward.service_id,
        redeem_token=token,
        status="ACTIVE",
    )
    db.session.add(voucher)
    db.session.commit()

    base_url = request.host_url.rstrip("/")
    redeem_url = f"{base_url}/v/{token}"

    caption = f" Your Rubi Trail voucher\n{reward.title}\n\nOpen: {redeem_url}"
    sent = send_telegram_qr(user.telegram_id, caption, redeem_url)
    if not sent:
        send_telegram_message(user.telegram_id, caption)

    return jsonify({
        "success": True,
        "message": "Voucher created.",
        "newBalance": user.coins,
        "voucher": {"id": voucher.id, "redeemUrl": redeem_url},
    })


VOUCHER_TEMPLATE = """<!DOCTYPE html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
<body style="font-family:system-ui;display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f4f5f7;margin:0;">
<div style="background:#fff;padding:24px;border-radius:16px;max-width:420px;width:100%;text-align:center;">
{% if invalid %}
<h2>Voucher invalid or already redeemed.</h2>
{% else %}
<h2>{{ service.name }}</h2>
<h3>{{ reward.title }}</h3>
<p>{{ reward.description }}</p>
<p><b>Status:</b> {{ voucher.status }}</p>
<button id="redeem-btn" style="padding:12px 24px;border-radius:999px;border:none;background:#e53935;color:#fff;font-weight:700;cursor:pointer;">Redeem now</button>
<p id="msg"></p>
<script>
const token="{{ token }}";
document.getElementById("redeem-btn").addEventListener("click", async () => {
  const btn = document.getElementById("redeem-btn");
  btn.disabled = true;
  btn.textContent = "Processing...";
  const res = await fetch("/api/vouchers/redeem", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ token })
  });
  const data = await res.json();
  document.getElementById("msg").textContent = data.success ? "Redeemed " : (data.message || "Invalid");
  btn.style.display="none";
});
</script>
{% endif %}
</div></body></html>"""


@app.get("/v/<token>")
def voucher_page(token: str):
    v = Voucher.query.filter_by(redeem_token=token).first()
    if not v or v.status != "ACTIVE":
        return render_template_string(VOUCHER_TEMPLATE, invalid=True)
    return render_template_string(VOUCHER_TEMPLATE, invalid=False, token=token, voucher=v, reward=v.reward, service=v.service)


@app.post("/api/vouchers/redeem")
def redeem_voucher():
    data = request.get_json(silent=True) or {}
    token = (data.get("token") or "").strip()
    if not token:
        return jsonify({"success": False, "message": "Missing token"}), 400

    v = Voucher.query.filter_by(redeem_token=token).first()
    if not v:
        return jsonify({"success": False, "message": "Voucher not found"}), 404
    if v.status != "ACTIVE":
        return jsonify({"success": False, "message": "Voucher already redeemed"}), 400

    v.status = "REDEEMED"
    v.redeemed_at = datetime.utcnow()
    db.session.commit()
    return jsonify({"success": True, "message": "Voucher redeemed successfully"})


if __name__ == "__main__":
    port = int(os.environ.get("PORT", "10000"))
    app.run(host="0.0.0.0", port=port, debug=False)
